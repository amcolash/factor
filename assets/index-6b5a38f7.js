import{r as l,j as e,b as G}from"./react-8cd704d4.js";import{u as F,a as Z,b as K,F as V,P as q,d as z,B as j,c as J,J as N,e as Q,f as B,g as S,r as _,l as C,h as T,i as $,j as I,T as ee,C as te,k as se,m as re,Q as ne,X as oe}from"./vendor-7d8825ec.js";import{i as ae,g as ie,c as ce,p as le,d as de,t as ue,e as fe,u as A,f as H,h as me,j as he}from"./firebase-a683faaf.js";import{i as ge,s as xe}from"./simple-icons-c7de5a36.js";import{z as pe}from"./qr-scanner-750bbc23.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(a){if(a.ep)return;a.ep=!0;const n=r(a);fetch(a.href,n)}})();const we="modulepreload",je=function(t){return"/factor/"+t},P={},be=function(s,r,o){if(!r||r.length===0)return s();const a=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=je(n),n in P)return;P[n]=!0;const i=n.endsWith(".css"),d=i?'[rel="stylesheet"]':"";if(!!o)for(let c=a.length-1;c>=0;c--){const h=a[c];if(h.href===n&&(!i||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${d}`))return;const f=document.createElement("link");if(f.rel=i?"stylesheet":we,i||(f.as="script",f.crossOrigin=""),f.href=n,document.head.appendChild(f),i)return new Promise((c,h)=>{f.addEventListener("load",c),f.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>s()).catch(n=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n})};function ve(t={}){const{immediate:s=!1,onNeedRefresh:r,onOfflineReady:o,onRegistered:a,onRegisteredSW:n,onRegisterError:i}=t;let d,m,f;const c=async(u=!0)=>{await m,await(f==null?void 0:f())};async function h(){if("serviceWorker"in navigator){if(d=await be(()=>import("./workbox-window.prod.es5-a7b12eab.js"),[]).then(({Workbox:u})=>new u("/factor/sw.js",{scope:"/factor/",type:"classic"})).catch(u=>{i==null||i(u)}),!d)return;f=async()=>{await(d==null?void 0:d.messageSkipWaiting())};{let u=!1;const x=()=>{u=!0,d==null||d.addEventListener("controlling",w=>{w.isUpdate&&window.location.reload()}),r==null||r()};d.addEventListener("installed",w=>{typeof w.isUpdate>"u"?typeof w.isExternal<"u"?w.isExternal?x():!u&&(o==null||o()):w.isExternal?window.location.reload():!u&&(o==null||o()):w.isUpdate||o==null||o()}),d.addEventListener("waiting",x),d.addEventListener("externalwaiting",x)}d.register({immediate:s}).then(u=>{n?n("/factor/sw.js",u):a==null||a(u)}).catch(u=>{i==null||i(u)})}}return m=h(),c}const E=l.createContext(void 0),ye={apiKey:"AIzaSyDMQ4jffBbrLTjdhy_qS4GeZdbYtzEKHp4",authDomain:"factor-97c20.firebaseapp.com",projectId:"factor-97c20",storageBucket:"factor-97c20.appspot.com",messagingSenderId:"524844196447",appId:"1:524844196447:web:9d5f59006ec0b8e68d31ea"},O=ae(ye),v=ie(O),L=ce(O,{localCache:le()});function Ae(){const[t]=F(v),s=de(L,"users",(t==null?void 0:t.uid)||""),[r,o,a]=Z(s);return{value:r,loading:o,error:a,userRef:s}}const U="/factor/assets/logo-d1f49d9e.png";function Ce({className:t}){return e.jsx("img",{src:U,className:"h-52 mb-10 "+t,style:{clipPath:"circle(40%)"}})}function X({className:t,children:s}){return e.jsxs("div",{className:"w-screen h-[100svh] flex flex-col justify-center items-center",children:[e.jsx("h1",{className:"mt-30 text-center text-5xl font-bold mb-2",children:"Factor"}),e.jsx("img",{src:U,className:"h-52 mb-10 "+t,style:{clipPath:"circle(40%)"}}),s]})}function ke({unlock:t,encryptedCode:s}){const r=l.useRef(null),[o]=K(v);l.useEffect(()=>{setTimeout(()=>{var n;return(n=r.current)==null?void 0:n[0].focus()},250)},[]);const a=async n=>{try{const i=await z(n,s);t(i.token)}catch(i){console.log(i,n),j.error("Invalid code")}r.current&&(r.current.forEach(i=>{i.value=""}),r.current[0].focus())};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"icon fixed top-4 right-4 bg-danger",onClick:async()=>{try{await o(),await ue(L),await fe(L)}catch(n){console.error(n)}},children:e.jsx(V,{})}),e.jsxs("div",{className:"w-screen h-[100svh] flex flex-col justify-center items-center",onClick:()=>{r.current&&r.current[0].focus()},style:{marginTop:"calc(-1 * env(keyboard-inset-height) / 2)"},children:[e.jsx("h1",{className:"mt-30 text-center text-5xl font-bold mb-2",children:"Factor"}),e.jsx(Ce,{}),e.jsx("div",{className:"flex",children:e.jsx(q,{length:6,className:"border border-slate-500 w-11 sm:w-12 h-14 m-1.5 rounded-lg text-center text-6xl p-1 outline-none outline-offset-0 outline-4",type:"password",inputMode:"numeric",ref:r,onComplete:a,onClick:n=>n.stopPropagation()})})]})]})}function Ne(){const[t]=F(v),[s,,r,o]=J(v);return e.jsxs("div",{className:"w-screen h-screen flex justify-center items-center flex-col",children:[!t&&!r&&e.jsx("button",{onClick:()=>s(),children:"Login with Google"}),r&&e.jsx("p",{children:"Loading..."}),o&&e.jsxs("p",{children:["Error: ",o.message]})]})}function Se({lock:t,updateCode:s,editMode:r,setEditMode:o,setEditKey:a}){const n="p-4 rounded-full",i=N(s,{threshold:600,onCancel:(m,{reason:f})=>{f===S.CancelledByRelease&&t()}}),d=N(()=>{o(!0)},{threshold:600,onCancel:(m,{reason:f})=>{f===S.CancelledByRelease&&(r?o(!1):setTimeout(()=>a(!0),10))}});return e.jsxs("div",{className:"fixed bottom-8 right-8 flex gap-4 z-20",children:[e.jsx("button",{className:n+" !bg-slate-800 !text-primary outline outline-primary outline-2 -outline-offset-2",...d(),children:e.jsx(Q,{})}),e.jsx("button",{className:"transition-transform "+n+(r?" rotate-45":""),...i(),children:e.jsx(B,{})})]})}function Le(){const[t,s]=l.useState(new Date),[r,o]=l.useState(new Date);return l.useEffect(()=>{const a=setInterval(()=>o(new Date),1e3);let n;return setTimeout(()=>{s(new Date),n=setInterval(()=>s(new Date),3e4)},3e4-new Date().getTime()%3e4),()=>{n&&clearInterval(n),clearInterval(a)}},[]),{time:r,timestamp:t}}const D={content:["./index.html","./src/**/*.{js,ts,jsx,tsx}"],theme:{extend:{colors:{primary:"#4b888d",secondary:"#051524",danger:"#f07f7b"},keyframes:{wiggle:{"0%, 100%":{transform:"rotate(-0.5deg)"},"50%":{transform:"rotate(0.5deg)"}}},animation:{wiggle:"wiggle 400ms ease-in-out infinite"}}},plugins:[]};function Fe(){return l.useMemo(()=>_(D),[D])}const Te="/factor/assets/bastillion-20eb2954.png",Ee="/factor/assets/betterment-167c0633.png",Me="data:image/png;base64,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",Pe="/factor/assets/guideline-a1e4c339.png",De="/factor/assets/id.me-b0908efb.png",Re="/factor/assets/justworks-65bba49e.jpg",We="/factor/assets/uwcu-d5149b71.png";function ze(t){if(!t)return;let s=Object.entries(ge).filter(r=>t.toLowerCase().includes(r[1].title.toLowerCase())&&C(t.toLowerCase(),r[1].title.toLowerCase())<t.length/2).sort((r,o)=>C(t.toLowerCase(),r[1].title.toLowerCase())-C(t.toLowerCase(),o[1].title.toLowerCase()))[0];switch(t){case"Bastillion":return Te;case"Betterment":return Ee;case"Carta":return Me;case"Guideline":return Pe;case"ID.me":return De;case"Justworks":return Re;case"NAS":return xe;case"UW Credit Union":return We}return s?s[1]:void 0}const k="bg-slate-900",Be="bg-slate-800";function Ie(t){if(!t||typeof t=="string")return{background:k,fill:Be};let s=k,r="#"+t.hex;switch(t.title){case"Amazon":s=k;break;case"GitHub":case"Patreon":case"Ubisoft":s="bg-slate-300";break}return{background:s,fill:r}}function Y({name:t}){const s=ze(t),r=Ie(s),o="w-12 h-12 rounded-full border border-slate-400 "+r.background;return typeof s=="string"?e.jsx("img",{src:s,className:o+" object-cover"}):s?e.jsx("div",{dangerouslySetInnerHTML:{__html:s.svg},className:`${o} p-3 flex justify-center items-center`,style:{fill:r.fill}}):e.jsx("div",{className:o+" flex justify-center items-center",children:e.jsx(B,{})})}function He({close:t,onScan:s}){return e.jsx("div",{className:"absolute inset-0 w-screen h-screen bg-black flex justify-center z-10",children:e.jsxs("div",{className:"relative w-[100vh] p-2",children:[e.jsx("div",{className:"absolute bottom-14 right-0 left-0 z-10 flex justify-center",children:e.jsx("button",{className:"icon",onClick:t,children:e.jsx(T,{})})}),e.jsx(pe,{onResult:async r=>{try{const o=new URL(r),a=decodeURIComponent(o.pathname.replace("//totp/","")).split(":")[0],n=o.searchParams.get("secret");if(o.protocol!=="otpauth:"||!a||!n)throw new Error(`Invalid URL: ${o.toString()}`);s(a,n),t()}catch(o){console.error(o),j.error("Failed to scan key")}},onError:r=>console.error(r==null?void 0:r.message),components:{audio:!1}})]})})}function Oe(t){const[s,r]=l.useState(t.name||""),[o,a]=l.useState(t.secret||""),[n,i]=l.useState(!1),d=l.useContext(E)||"",m=t.name||t.secret,f=async(c,h)=>{if(c===""||h===""){j.error("Name and secret are required");return}try{m&&(t.name!==c||t.secret!==h)&&await A(t.userRef,{keys:H({name:t.name,secret:t.secret})});const u=await I(d,{secret:h});await A(t.userRef,{keys:me({name:c,secret:u})}),r(""),a(""),t.close()}catch(u){console.error(u),j.error("Failed to add key")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col w-full gap-8",onKeyDown:c=>{c.key==="Enter"&&f(s,o)},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h2",{className:"flex-1 text-lg font-medium",children:m?"Edit existing key":"Add a new key"}),e.jsx("button",{onClick:t.close,className:"px-2",children:e.jsx(T,{})})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(Y,{name:s}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{value:s,onChange:c=>r(c.target.value),placeholder:"Site name",autoFocus:!0,autoComplete:"false",type:"text"}),e.jsx("input",{value:o,onChange:c=>a(c.target.value),placeholder:"Secret",autoComplete:"false",type:"password"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[!m&&e.jsx("button",{onClick:()=>i(!0),children:e.jsx($,{})}),e.jsx("button",{onClick:()=>f(s,o),className:"flex-1",children:t.name||t.secret?"Save":"Add"})]})]}),n&&e.jsx(He,{close:()=>i(!1),onScan:(c,h)=>{r(c),a(h)}})]})}function Ue(){const[t,s]=l.useState(null);return[l.useCallback(async o=>{if(!(navigator!=null&&navigator.clipboard))return console.warn("Clipboard not supported"),!1;try{return await navigator.clipboard.writeText(o),s(o),!0}catch(a){return console.warn("Copy failed",a),s(null),!1}},[]),t]}function Xe(){const[t,s]=l.useState(!1);return l.useEffect(()=>{const r=()=>{s(window.innerWidth<500)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),t}function Ye({data:t,userRef:s,timestamp:r,onEdit:o,setEditMode:a,editMode:n,index:i}){const d=l.useContext(E)||"",[m,f]=l.useState(""),[c,h]=l.useState(0),u=Xe(),[x]=Ue(),w=N(()=>a(!0),{threshold:600,onCancel:(p,{reason:M})=>{M===S.CancelledByRelease&&(c===0?h(1):n?o():b())}});l.useEffect(()=>{c!==0&&z(d,t.secret).then(p=>f(p.secret)).catch(p=>{console.error(p),f("Error")})},[t.secret,d,c]);const y=Math.floor(r.getTime()/3e4),g=l.useMemo(()=>{if(m.length===0||m==="Error"||c===0)return"Token Error";try{return ee.generate(m.replace(/\s+/g,""),{timestamp:y*3e4}).otp}catch(p){return console.error(p),"Token Error"}},[m,y,c]),b=l.useCallback(()=>x(g).then(p=>{p&&g!=="Token Error"?j.info(t.name+" code copied",{bodyClassName:u?"text-right":""}):j.error("Failed to copy code")}),[g,t,u,x]);return l.useEffect(()=>{c===1&&g!=="Token Error"&&(b(),h(2))},[c,g]),e.jsxs("div",{className:"p-3 bg-slate-800 border border-slate-700 rounded-md select-none flex gap-6 justify-between items-center hover:brightness-[97%] relative cursor-pointer transition-transform duration-1000 rotate-0"+(n?" animate-wiggle":""),style:{animationDelay:`${i*100}ms`},...w(),children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(Y,{name:t.name}),e.jsxs("div",{className:"flex flex-col items-start justify-center",children:[e.jsx("h2",{className:"font-bold capitalize",children:t.name}),e.jsx("div",{children:c===0?"*** ***":m.length===0?"Decrypting...":g==="Token Error"?"Token Error":e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:g.slice(0,3)}),e.jsx("span",{children:g.slice(3,6)})]})})]})]}),e.jsx("button",{className:"absolute -top-3 -right-3 !p-1 text-slate-800 bg-white border border-slate-400 rounded-full hover:text-white hover:brightness-100 sm:hover:bg-danger transition-all duration-300",style:{pointerEvents:n?"auto":"none",opacity:n?1:0},onClick:p=>{p.stopPropagation(),window.confirm("Are you sure you want to remove this token?")&&window.confirm("Are you really sure?")&&A(s,{keys:H(t)})},onMouseDown:p=>p.stopPropagation(),onTouchStart:p=>p.stopPropagation(),onPointerDown:p=>p.stopPropagation(),children:e.jsx(T,{})})]})}function Ge({userData:t,userRef:s,editMode:r,setEditMode:o,editKey:a,setEditKey:n}){const{time:i,timestamp:d}=Le(),[m,f]=l.useState(""),[c,h]=l.useState(),u=Fe(),x=3e4-i.getTime()%3e4,w=Math.ceil(x/1e3),y=l.useMemo(()=>e.jsxs(e.Fragment,{children:[t.keys.length===0&&e.jsx("div",{className:"text-center text-lg bg-slate-800 p-8 w-full rounded-md",children:"No keys added yet"}),t.keys.length>0&&e.jsxs("div",{className:"w-full max-w-screen-lg",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"mb-6 pl-10",type:"search",value:m,placeholder:"Search tokens",onChange:g=>f(g.target.value)}),e.jsx("svg",{className:"fill-slate-400 absolute left-3 top-[11px] h-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",children:e.jsx("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"})})]}),e.jsx("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 sm:gap-6",children:t.keys.filter(g=>m.length===0||g.name.toLowerCase().includes(m.toLowerCase())).sort((g,b)=>g.name.localeCompare(b.name)).map((g,b)=>{try{return e.jsx(Ye,{data:g,userRef:s,timestamp:d,onEdit:()=>{n(!0),h(g)},setEditMode:o,editMode:r,index:b},g.name)}catch(p){return console.error(p),e.jsxs("div",{children:["Error Loading Token (",g.name,")"]})}})})]})]}),[t.keys,m,d,s,r]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-0 left-0 h-1.5 bg-primary transition-transform duration-700 w-screen z-20 rounded",style:{transform:`scaleX(${w/30*100}%)`}}),e.jsx("div",{className:"flex sm:justify-center pl-8 sm:pl-0 w-full fixed bottom-0 left-0 right-0 pointer-events-none z-10 backdrop-blur-lg bg-slate-900 bg-opacity-30 pt-4",children:e.jsx("div",{className:"w-16 h-16 p-1 mb-6",children:e.jsx(te,{value:w-1,maxValue:30,text:w.toString(),styles:se({textSize:"40px",trailColor:u.theme.colors.slate[700],textColor:u.theme.colors.primary,pathColor:u.theme.colors.primary}),strokeWidth:10})})}),e.jsx("div",{className:"flex flex-col gap-4 m-6 sm:m-8 items-center pb-24",children:y}),a&&e.jsx("div",{className:"fixed z-10 inset-0 bg-slate-900 bg-opacity-75 flex justify-center items-center",onClick:()=>{n(!1),h(void 0)},children:e.jsx("div",{className:"max-w-screen-md bg-slate-700 rounded-lg p-8",onClick:g=>g.stopPropagation(),style:{marginTop:"calc(-1 * env(keyboard-inset-height))"},children:e.jsx(Oe,{name:c==null?void 0:c.name,secret:c==null?void 0:c.secret,userRef:s,close:()=>{n(!1),h(void 0)}})})})]})}function Ze(){const[t,s,r]=F(v);return s||r?e.jsx(X,{children:r&&e.jsxs("p",{children:["Error: ",r.message]})}):t?e.jsx(Ke,{user:t}):e.jsx(Ne,{})}async function R(t){let s="",r=0;for(;s.length!==6&&r<3;)s=prompt("Enter 6 digit pin")||"",r++;if(s.length===6&&(prompt("Re-enter 6 digit pin")||"")!==s){j.error("Codes do not match",{autoClose:5e3});return}if(s.length===6){t||(t=crypto.getRandomValues(new Uint32Array(32)).toString());try{return await I(s,{token:t})}catch(o){console.error(o)}}}function Ke({user:t}){var u;const{value:s,loading:r,error:o,userRef:a}=Ae(),[n,i]=l.useState(),[d,m]=l.useState(!1),[f,c]=l.useState(!1);l.useEffect(()=>{const x=()=>{document.visibilityState==="visible"&&i(void 0)};return document.addEventListener("visibilitychange",x),()=>document.removeEventListener("visibilitychange",x)},[]),l.useEffect(()=>{!r&&!o&&(s==null?void 0:s.data())===void 0&&R().then(x=>{x?he(a,{keys:[],email:t.email||"",code:x}):j.error("Failed to create user")})},[s,r,o]);const h=async()=>{const x=await R(n);x?A(a,{code:x}):j.error("Failed to update code")};return r||o||!s||s.data()===void 0?e.jsxs(X,{children:[o&&e.jsxs("p",{children:["Error: ",o.message]}),!s||s.data()===void 0&&e.jsx("p",{children:"No data"})]}):n?e.jsxs(E.Provider,{value:n,children:[e.jsx(Se,{lock:()=>i(void 0),updateCode:h,editMode:d,setEditKey:c,setEditMode:m}),e.jsx(Ge,{userData:s.data(),userRef:a,editMode:d,setEditMode:m,editKey:f,setEditKey:c})]}):e.jsx(ke,{unlock:x=>i(x),encryptedCode:(u=s.data())==null?void 0:u.code})}window.global||(window.global=window);globalThis.Buffer=re.Buffer;const Ve=ve({onNeedRefresh(){confirm("New content available. Reload?")&&Ve(!0)}}),qe=matchMedia("(display-mode: browser)").matches;qe||window.resizeTo(500,760);const W=navigator;W.virtualKeyboard&&(W.virtualKeyboard.overlaysContent=!0);function Je(){return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{}),e.jsx(ne,{theme:"dark",position:"bottom-center",transition:oe,autoClose:1e3,hideProgressBar:!0,closeButton:!1})]})}G(document.getElementById("root")).render(e.jsx(Je,{}));
