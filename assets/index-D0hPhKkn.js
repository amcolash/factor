function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["/factor/assets/vendor-DiFyTCEx.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{r as m,u as D,a as Q,B as x,d as C,e as E,j as e,b as _,F as $,P as ee,c as O,f as te,J as P,g as re,h as se,i as ne,k as Y,l as T,m as oe,n as F,p as z,q as ae,s as ie,t as ce,T as le,C as de,v as ue,w as fe,x as me,y as ge,Q as pe,X as he}from"./vendor-Blq3S4Ne.js";import{i as xe,g as ye,a as we,p as be,d as je,u as A,b as B,t as ve,c as Ce,e as Z,s as Ae}from"./firebase-CQ7Shay7.js";import{i as ke,s as Se,a as Ne}from"./simple-icons-5YJPn3BQ.js";import{z as Ee}from"./qr-scanner-okGx8PHk.js";import"./index-D0hPhKkn.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();var Ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function At(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function kt(t){if(t.__esModule)return t;var s=t.default;if(typeof s=="function"){var r=function n(){return this instanceof n?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};r.prototype=s.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var o=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:function(){return t[n]}})}),r}const Le="modulepreload",Fe=function(t,s){return t[0]==="."?new URL(t,s).href:t},W={},Ie=function(s,r,n){let o=Promise.resolve();if(r&&r.length>0){const i=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),d=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.all(r.map(f=>{if(f=Fe(f,n),f in W)return;W[f]=!0;const u=f.endsWith(".css"),y=u?'[rel="stylesheet"]':"";if(!!n)for(let g=i.length-1;g>=0;g--){const p=i[g];if(p.href===f&&(!u||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${y}`))return;const a=document.createElement("link");if(a.rel=u?"stylesheet":Le,u||(a.as="script",a.crossOrigin=""),a.href=f,d&&a.setAttribute("nonce",d),document.head.appendChild(a),u)return new Promise((g,p)=>{a.addEventListener("load",g),a.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${f}`)))})}))}return o.then(()=>s()).catch(i=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i})};function Pe(t={}){const{immediate:s=!1,onNeedRefresh:r,onOfflineReady:n,onRegistered:o,onRegisteredSW:i,onRegisterError:l}=t;let d,f,u;const y=async(a=!0)=>{await f,await(u==null?void 0:u())};async function c(){if("serviceWorker"in navigator){if(d=await Ie(()=>import("./vendor-Blq3S4Ne.js").then(a=>a.A),__vite__mapDeps([0]),import.meta.url).then(({Workbox:a})=>new a("/factor/sw.js",{scope:"/factor/",type:"classic"})).catch(a=>{l==null||l(a)}),!d)return;u=async()=>{await(d==null?void 0:d.messageSkipWaiting())};{let a=!1;const g=()=>{a=!0,d==null||d.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()}),r==null||r()};d.addEventListener("installed",p=>{typeof p.isUpdate>"u"?typeof p.isExternal<"u"?p.isExternal?g():!a&&(n==null||n()):p.isExternal?window.location.reload():!a&&(n==null||n()):p.isUpdate||n==null||n()}),d.addEventListener("waiting",g),d.addEventListener("externalwaiting",g)}d.register({immediate:s}).then(a=>{i?i("/factor/sw.js",a):o==null||o(a)}).catch(a=>{l==null||l(a)})}}return f=c(),y}const L=m.createContext(void 0);function Te(){const[t,s]=m.useState(navigator.onLine);return m.useEffect(()=>{function r(){s(navigator.onLine)}return window.addEventListener("online",r),window.addEventListener("offline",r),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",r)}},[]),t}const Me={apiKey:"AIzaSyDMQ4jffBbrLTjdhy_qS4GeZdbYtzEKHp4",authDomain:"factor-97c20.firebaseapp.com",projectId:"factor-97c20",storageBucket:"factor-97c20.appspot.com",messagingSenderId:"524844196447",appId:"1:524844196447:web:9d5f59006ec0b8e68d31ea"},q=xe(Me),v=ye(q),M=we(q,{localCache:be()});function Re(){const[t]=D(v),s=je(M,"users",(t==null?void 0:t.uid)||""),[r,n,o]=Q(s);return{value:r,loading:n,error:o,userRef:s}}async function De(t,s){const r=x(`Exporting keys ⏳️
This might take some time...`,{autoClose:!1,progress:1/s.keys.length,hideProgressBar:!1}),n=[];for(let d=0;d<s.keys.length;d++){const f=s.keys[d],u=await C(t,f.secret);n.push({name:f.name,secret:u.secret}),x.update(r,{progress:d/s.keys.length})}x.done(r);const o=new Blob([JSON.stringify(n)],{type:"text/json"}),i=URL.createObjectURL(o),l=document.createElement("a");l.href=i,l.download="keys.json",l.click(),URL.revokeObjectURL(i)}async function ze(t,s,r){const n=document.createElement("input");n.type="file",n.addEventListener("change",o=>{if(n.files&&n.files[0]){const i=n.files[0],l=new FileReader;l.onload=async d=>{try{if(d.target){const f=JSON.parse(d.target.result);let u=0,y=0;for(const c of f){if(!c.name||!c.secret)throw"Invalid file format";const a=c.name;if(s.keys.some(g=>g.name.toLowerCase()===a.toLowerCase()))u++;else{const g=await E(t,c.secret);await A(r,{keys:B({name:a,secret:g})}),y++}}u>0&&x.warning(`${u} keys were skipped because they already exist`),y>0&&x.success(`Imported ${f.length-u} keys`)}}catch(f){console.error(f),x.error(f||"Error importing keys")}},l.readAsText(i)}}),n.click()}const V=Uint8Array.from(window.crypto.getRandomValues(new Uint8Array(32)));async function Be(){try{const t=Uint8Array.from(window.crypto.getRandomValues(new Uint8Array(32))),s={challenge:V,rp:{name:"Factor"},user:{id:t,name:"user",displayName:"User"},pubKeyCredParams:[{type:"public-key",alg:-7}],authenticatorSelection:{requireResidentKey:!0}},r=await navigator.credentials.create({publicKey:s});return{userHandle:R(t),credentialId:R(r.rawId)}}catch(t){console.error("Error registering credential:",t)}return null}async function Oe(t){try{const s=Ue(t),r={challenge:V,allowCredentials:[{type:"public-key",id:s}]},n=await navigator.credentials.get({publicKey:r});if(n!=null&&n.response)return R(n.response.userHandle)}catch(s){console.error("Error authenticating:",s)}return null}function We(t){const s=new Uint8Array(t),r=Array.from(s);return String.fromCharCode.apply(null,r)}function R(t){return btoa(We(t))}function Ue(t){const s=atob(t),r=s.length,n=new ArrayBuffer(r),o=new Uint8Array(n);for(let i=0;i<r;i++)o[i]=s.charCodeAt(i);return n}const He="/factor/assets/logo-lomxQ9_I.png";function Ke({className:t}){return e.jsx("img",{src:He,className:"h-52 "+t})}function N({className:t,children:s,...r}){return e.jsxs("div",{className:"w-screen h-[100svh] flex flex-col justify-center items-center gap-5",...r,children:[e.jsx("h1",{className:"text-center m-0 -mb-1",children:"Factor"}),e.jsx(Ke,{className:t}),s]})}let U=!1;function Xe({unlock:t,encryptedCode:s,data:r,userRef:n}){var y;const o=m.useRef(null),[i]=_(v),l=(y=r==null?void 0:r.webauthn)==null?void 0:y.find(c=>{var a;return c.uuid===((a=v.currentUser)==null?void 0:a.uid)});m.useEffect(()=>{setTimeout(()=>{var c;return(c=o.current)==null?void 0:c[0].focus()},250)},[]),m.useEffect(()=>{l&&!U&&(d(),U=!0)},[l]);const d=async()=>{try{if(!l)throw"webauthn not defined";const c=await Oe(l.credentialId).catch(console.error),a=await C(c||"",l.secret);t(a.token)}catch(c){console.error(c),x.error("Invalid biometric login")}},f=async()=>{var c;try{const a=prompt("Enter pin to register biometric login")||"",g=await C(a,s),p=await Be(),b=(p==null?void 0:p.userHandle)||"",w=await E(b,g);A(n,{webauthn:B({credentialId:p==null?void 0:p.credentialId,uuid:(c=v.currentUser)==null?void 0:c.uid,secret:w})}),x.success("Successfully enrolled biometric login")}catch(a){console.error(a),x.error("Error registering fingerprint")}},u=async c=>{if((c==null?void 0:c.length)===6)try{const a=await C(c,s);t(a.token)}catch(a){console.log(a,c),x.error("Invalid code")}o.current&&(o.current.forEach(a=>{a.value=""}),o.current[0].focus())};return e.jsxs(N,{onClick:()=>{o.current&&o.current[0].focus()},style:{marginTop:"calc(-1 * env(keyboard-inset-height) / 2)"},children:[e.jsx("button",{className:"icon fixed top-4 right-4 bg-danger",onClick:async()=>{try{await i(),await ve(M),await Ce(M)}catch(c){console.error(c)}},children:e.jsx($,{})}),e.jsx("div",{className:"flex mb-6",children:e.jsx(ee,{length:6,className:"border border-slate-500 w-10 sm:w-12 h-14 m-1.5 rounded-lg text-center text-6xl p-1",type:"password",inputMode:"numeric",ref:o,onComplete:u,onClick:c=>c.stopPropagation()})}),l?e.jsx("button",{className:"p-3 rounded-full bg-slate-900 bg-opacity-75 border-2 border-slate-600",onClick:async c=>{c.stopPropagation(),d()},children:e.jsx(O,{size:30})}):e.jsx("button",{className:"p-3 rounded-full bg-slate-900 bg-opacity-75 border-2 border-slate-600",onClick:async c=>{c.stopPropagation(),f()},children:e.jsx(O,{size:30})})]})}function Ge(){const[t]=D(v),[s,,r,n]=te(v);return e.jsxs("div",{className:"flex justify-center items-center flex-col",children:[!t&&!r&&e.jsx(Ye,{signin:()=>s()}),r&&e.jsx("p",{children:"Loading..."}),n&&e.jsxs("p",{children:["Error: ",n.message]})]})}function Ye({signin:t}){return e.jsxs("button",{className:"gsi-material-button",onClick:t,children:[e.jsx("div",{className:"gsi-material-button-state"}),e.jsxs("div",{className:"gsi-material-button-content-wrapper",children:[e.jsx("div",{className:"gsi-material-button-icon",children:e.jsxs("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",style:{display:"block"},children:[e.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),e.jsx("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),e.jsx("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),e.jsx("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"}),e.jsx("path",{fill:"none",d:"M0 0h48v48H0z"})]})}),e.jsx("span",{className:"gsi-material-button-contents",children:"Sign in with Google"}),e.jsx("span",{style:{display:"none"},children:"Sign in with Google"})]})]})}function Ze({lock:t,updateCode:s,editMode:r,setEditMode:n,setEditKey:o,exportKeys:i,importKeys:l}){const d="p-4 rounded-full",f=d+" !bg-slate-800 !text-primary",u=P(s,{threshold:600,onCancel:(c,{reason:a})=>{a===T.CancelledByRelease&&t()}}),y=P(()=>{n(!0)},{threshold:600,onCancel:(c,{reason:a})=>{a===T.CancelledByRelease&&(r?n(!1):setTimeout(()=>o(!0),10))}});return e.jsxs("div",{className:"fixed bottom-8 right-8 flex gap-4 z-20",children:[r&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:f,onClick:()=>l(),children:e.jsx(re,{})}),e.jsx("button",{className:f+" mr-4",onClick:()=>i(),children:e.jsx(se,{})})]}),e.jsx("button",{className:f+(r?" rotate-45":""),...y(),children:e.jsx(ne,{})}),e.jsx("button",{className:"transition-transform "+d,...u(),children:e.jsx(Y,{})})]})}function qe(){const[t,s]=m.useState(new Date),[r,n]=m.useState(new Date);return m.useEffect(()=>{const o=setInterval(()=>n(new Date),1e3);let i;return setTimeout(()=>{s(new Date),i=setInterval(()=>s(new Date),3e4)},3e4-new Date().getTime()%3e4),()=>{i&&clearInterval(i),clearInterval(o)}},[]),{time:r,timestamp:t}}const H={content:["./index.html","./src/**/*.{js,ts,jsx,tsx}"],theme:{extend:{colors:{primary:"#4b888d",secondary:"#051524",tertiary:"#2c2155",danger:"#f07f7b"},keyframes:{wiggle:{"0%, 100%":{transform:"rotate(-0.5deg)"},"50%":{transform:"rotate(0.5deg)"}}},animation:{wiggle:"wiggle 400ms ease-in-out infinite"}}},plugins:[]};function Ve(){return m.useMemo(()=>oe(H),[H])}const Je="/factor/assets/bastillion-C8U43q6p.png",Qe="/factor/assets/betterment-qyE9Qf23.png",_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAADwCAAAAAAbPrZOAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAD/h4/MvwAAAAd0SU1FB+gDHgYUFh9Sd4UAAAdJSURBVHja7ZxpbBRlGICfHhQspVSLB4IGEVBRMUjxDIoS8IjxxvvCBDSgBu+EH94ooRqPgBJEDMZ4oDE2igikkmi0CFRQiloNUJGrIi29aKl1P3/M7HZmdpntzli2fXmfP51532/e73t2Zuf4ZtMMw6FFZroHoMIqrMIqrMIqrMKHDiosHRWWjgpLR4Wlo8LSUWHpqLB0VFg6KiwdFZaOCktHhaWjwtJRYemosHRUWDoqLB0Vlo4KS0eFpaPC0lFh6aiwdFRYOiosHRWWjgpLR4Wlo8LSUWHpqLB0VFg6KiwdFZaOCksn2y9Z8dgR6R5fAGpmn+aXNj6sTffYg7HWz8n3kM5I99CD4Tts/Q7H0f/Yf9M9yA6TtacqvPCsG9rS7dFhsj++Pbxwbq90a6RAz6Qtkn+Hu9X/gUw+2EPupKXC0lFh6aiwdFRYOiosneQPDweT1ghgenXmxEPX2sNPHjZ06JDcus7somvt4Xq2dXYXXWsPH4TRdC3hg4AKS6crCnfqdHj4s3Rzw4aatuzCk/v0SZBs2F5VF+k76DhvzrRlYOgBtOyryS3IBRozyLHmRxt7GDC9270jDdWVTeSdOCA//cJbP19Ybi8+fG1RjvujWLnsNXtx+sRzMilZ0ROzfy5A5YOHY/YvLGDJM6th7lRo6VOQ2XMnACMjhtbGncfY2zatLFlgLz5+xTnZzP0tm0jejMMCjtjvPUw5wGKfBrsedtUa+5UzWXKmM3d5hXmjvcN1ANRE7gfgTWNMs3dg2+0ynx/pjF7zm5kEcEpjwgF9CFDu5xRKuCTu4yuO5fZP9eZWvtcuvB6Ahmc4sPAOY4wxtdO88TUPAJwVVDjMIT3n/rjQo3XPWgvNY1d7cxdd4AkcXvpEsi72XrDBGxo9NMSQQ32H50V9Z56XwUZ7Tzw38B6Af26L+U4eWv9uFQBfewoUXm0vtCYqHwHMLTHfKSfsWboRgN9DCQc/pJfbBUrt9TUDrfV6Y4x5x04u+NMYY0zzslx3h+tjq6OW/FK1xxjT9k1ZWfk4AJavKisr+7bJGFNsN1q40xhjTP3S2GaBD+nAwjVWx3fWtX9r7wXebDbGmE1WcsLvsWTz5MTCr0WcRW9u/8iMMWaz1WbEjliDugfCCgc+pD8F4KbX23ddzpzqE6cPcCQHf1gQS/aaH3krQZVi92kgAkDs9ewcy21531iD/OLInKAjdn7gqe/hBmvrza5gs/233kr+lGgL1x4e0equeiMAtfbabqtRpavJ7pB7OOitpXUhnXWCKxh9sWrdikw73ZXMWxJf5YUefn1YZ6dnh7mC/d4Pt4ODClcAcGXi5BYA7vZEx8Q3HIMfywCY6IlemBbhyA8AnJQ4uwaAMzzRvDu87S7xf9e+GaDfMZ5o/8vSIdz6FcCIxFtHvgQgyxPOONfb8FLfI9q6EIzr7Y2fRBiC7uHNAP0PMNItieNxVwT/HbyvGmBQ3FbhfiwXUNh6dGv0S3Yg7v/gm9MXYG9cvIEwBBTOmgDw3QFqXpc4XpVaHz0KAVbH+W1Ph3DOWABzgEnViwGo9ETbnkuxk2MB1tV7ok3fp0OY44Ho6TjxSCnzRH9JtY+xAKzwRH/elBZh62p4X4s7utb62ZB1eZ3U5E6+nmofp1plPGeK4lTL/D/CA6cA7HjVFfx6dOaiZuAI657jaVdy6bxU+xgyLkGZTz4KJxz4ack+mhc5Qtbj6tvGGOu2hNmOZJmrw/UAzPMWdd9Lm1XWFs87WpTaVQ76vTRF1nTWnTOjJ5XIMusQHACMfAiAx27ZaicbXj03tfIAnG2d7mdM+tMO1L48LuT+DTEBUBedannpxz17a3Z/Nt5ae8oYY0x1tPz099btrCx50dthx/aw+Tu60SMflFf/WvJKe5U0zGnlf2Ebu2Yub34cgKN+Hm6tv5JKyTgK1xZZCy+GKuMkxJuHIZvOj4s9NN++XTxlY1xu5tzU+xgVNxXIW5NTL/P/CDO49ElPpOSlvOji8F3Xu3Nvz0j+2954Ru/yPGO9e3e4dweh3i31fOoP5xTN/Frn8/HRH21wPMhNq7oLx3XZeqeyz1vQumuMOENHL/rGcSBN2XIr1QCrg/6qOcNvwx9GAYsn+hZoqigt3bJ70PCrhhXFJ/+qWFm6rWXYmEtH5gN1+4GsQgBaADJzPO1r2oCMft6Him2/rviuqvXk88YX5QO1/wDZiZ+ZFt8IlJ+JD4HP0l2STrwOd1dUWDoqLB0Vlo4KS0eFpaPC0lFh6ahwHFkdqNJlSD7flbxFee9u9E8PViVvk3SKp/uhUzxOVNhJ9/kXLR0ftu+89N6qbnWKjvoOKggqLBH9DktHhaWjwtJRYemosHRUWDoqLB0Vlo4KS0eFpaPC0lFh6aiwdFRYOiosHRWWjgpLR4Wlo8LSUWHpqLB0VFg6KiwdFZaOCktHhaWjwtJRYemosHRUWDoqLB0Vlo4KS0eFpaPC0lFh6aiwdFRYOiosnUNO+D9IFel9YsIbrgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyNC0wMy0zMFQwNjoyMDoyMiswMDowMI3CWJcAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjQtMDMtMzBUMDY6MjA6MjIrMDA6MDD8n+ArAAAAKHRFWHRkYXRlOnRpbWVzdGFtcAAyMDI0LTAzLTMwVDA2OjIwOjIyKzAwOjAwq4rB9AAAAABJRU5ErkJggg==",$e="/factor/assets/guideline-BzofyXre.png",et="/factor/assets/id.me-DKMQt8CE.png",tt="/factor/assets/justworks-GR0TnuZp.jpg",rt="/factor/assets/uwcu-Cguu5ZT9.png";function st(t){if(!t)return;let s=Object.entries(ke).filter(r=>t.toLowerCase().includes(r[1].title.toLowerCase())&&F(t.toLowerCase(),r[1].title.toLowerCase())<t.length/2).sort((r,n)=>F(t.toLowerCase(),r[1].title.toLowerCase())-F(t.toLowerCase(),n[1].title.toLowerCase()))[0];switch(t.toLowerCase()){case"bastillion":return{url:Je,padding:!0,type:"Image"};case"betterment":return{url:Qe,type:"Image"};case"carta":return{url:_e,type:"Image"};case"facebook":return{...Ne,padding:!1,type:"Icon"};case"guideline":return{url:$e,type:"Image"};case"id.me":return{url:et,type:"Image"};case"justworks":return{url:tt,type:"Image"};case"nas":return{...Se,type:"Icon"};case"uw credit union":case"uwcu":return{url:rt,padding:!0,type:"Image"}}return s?{...s[1],type:"Icon",padding:!0}:void 0}const I="bg-slate-900",nt="bg-slate-800";function ot(t){if(!t||t.type==="Image")return{background:I,fill:nt};const s=t;let r=I,n="#"+s.hex;switch(s.title.toLowerCase()){case"amazon":r=I;break;case"microsoft":n="#00a2ed";break;case"github":case"patreon":case"ubisoft":r="bg-slate-100";break}return{background:r,fill:n}}function J({name:t,className:s}){const r=st(t),n=ot(r),o="w-12 h-12 rounded-full border border-slate-400 flex justify-center items-center aspect-square "+n.background+" "+s;return r?r.type==="Image"?e.jsx("img",{src:r.url,className:o+` object-cover ${r.padding?"p-1":""}`}):e.jsx("div",{dangerouslySetInnerHTML:{__html:r.svg},className:`${o} ${r.padding?"p-2.5":"p-0.5"}`,style:{fill:n.fill}}):e.jsx("div",{className:o,children:e.jsx(Y,{})})}function at({close:t,onScan:s}){return e.jsx("div",{className:"absolute inset-0 w-screen h-screen bg-black flex justify-center z-10",children:e.jsxs("div",{className:"relative w-[100vh] p-2",children:[e.jsx("div",{className:"absolute bottom-14 right-0 left-0 z-10 flex justify-center",children:e.jsx("button",{className:"icon",onClick:t,children:e.jsx(z,{})})}),e.jsx(Ee,{onResult:async r=>{try{const n=new URL(r),o=decodeURIComponent(n.pathname.replace("//totp/","")).split(":")[0],i=n.searchParams.get("secret");if(n.protocol!=="otpauth:"||!o||!i)throw new Error(`Invalid URL: ${n.toString()}`);s(o,i),t()}catch(n){console.error(n),x.error("Failed to scan qr code")}},onError:r=>console.error(r==null?void 0:r.message),components:{audio:!1}})]})})}function it(t){const[s,r]=m.useState(t.name||""),[n,o]=m.useState(t.secret||""),[i,l]=m.useState(!1),[d,f]=m.useState(!0),[u,y]=m.useState(!1),c=m.useContext(L)||"",a=t.name||t.secret,g=async(p,b)=>{if(p===""||b===""){x.error("Name and secret are required");return}try{y(!0),a&&(t.name!==p||t.secret!==b)&&await A(t.userRef,{keys:Z({name:t.name,secret:t.secret})});const w=await E(c,{secret:b});await A(t.userRef,{keys:B({name:p,secret:w})}),r(""),o(""),f(!0),t.close()}catch(w){console.error(w),x.error("Failed to add key")}finally{y(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-8",onKeyDown:p=>{p.key==="Enter"&&g(s,n)},children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(J,{name:s,className:"w-14 h-14 sm:w-16 sm:h-16"}),e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx("input",{value:s,onChange:p=>r(p.target.value),placeholder:"Site name",autoFocus:!0,autoComplete:"false",type:"text"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:n,onChange:p=>o(p.target.value),placeholder:"Secret",autoComplete:"false",type:d?"password":"text"}),e.jsx("button",{className:"absolute right-0 top-0 bottom-0 flex items-center cursor-pointer bg-transparent",onClick:()=>f(!d),children:d?e.jsx(ae,{}):e.jsx(ie,{})})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[!a&&e.jsx("button",{onClick:()=>l(!0),children:e.jsx(ce,{})}),e.jsx("button",{onClick:()=>g(s,n),className:"flex-1",disabled:u,children:u?a?"Saving":"Adding":a?"Save":"Add"})]})]}),i&&e.jsx(at,{close:()=>l(!1),onScan:(p,b)=>{r(p),o(b)}})]})}function ct({onClose:t,title:s,children:r}){return e.jsx("div",{className:"fixed z-10 inset-0 bg-slate-900 bg-opacity-75 flex justify-center items-center",onClick:t,onKeyDown:n=>{n.key==="Escape"&&t()},children:e.jsxs("div",{className:"bg-slate-700 rounded-lg p-8 w-full",onClick:n=>n.stopPropagation(),style:{marginTop:"calc(-1 * env(keyboard-inset-height))",maxWidth:"min(80vw, 600px)"},children:[e.jsxs("div",{className:"flex items-center mb-8",children:[e.jsx("h2",{className:"flex-1 text-xl font-medium",children:s}),e.jsx("button",{onClick:t,className:"px-2 bg-slate-600 border-2 border-slate-800",children:e.jsx(z,{})})]}),r]})})}function lt(){const[t,s]=m.useState(null);return[m.useCallback(async n=>{if(!(navigator!=null&&navigator.clipboard))return console.warn("Clipboard not supported"),!1;try{return await navigator.clipboard.writeText(n),s(n),!0}catch(o){return console.warn("Copy failed",o),s(null),!1}},[]),t]}function dt(){const[t,s]=m.useState(!1);return m.useEffect(()=>{const r=()=>{s(window.innerWidth<500)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),t}function ut({data:t,userRef:s,timestamp:r,onEdit:n,setEditMode:o,editMode:i}){const l=m.useContext(L)||"",[d,f]=m.useState(""),[u,y]=m.useState(0),c=dt(),[a]=lt(),g=()=>{i?n():u===0?y(1):k()},p=P(()=>o(!i),{threshold:600,onCancel:(h,{reason:j})=>{j===T.CancelledByRelease&&g()}});m.useEffect(()=>{u!==0&&C(l,t.secret).then(h=>f(h.secret)).catch(h=>{console.error(h),f("Error")})},[t.secret,l,u]);const b=Math.floor(r.getTime()/3e4),w=m.useMemo(()=>{if(d.length===0||d==="Error"||u===0)return"Token Error";try{return le.generate(d.replace(/\s+/g,""),{timestamp:b*3e4}).otp}catch(h){return console.error(h),"Token Error"}},[d,b,u]),k=m.useCallback(()=>a(w).then(h=>{h&&w!=="Token Error"?x.success(t.name+" code copied",{bodyClassName:c?"text-right":"",autoClose:2500}):x.error("Failed to copy code",{autoClose:2500})}),[w,t,c,a]);return m.useEffect(()=>{u===1&&w!=="Token Error"&&(k(),y(2))},[u,w]),e.jsxs("div",{className:"p-3 bg-slate-800 border border-slate-700 rounded-md select-none flex gap-6 justify-between items-center hover:brightness-[90%] relative cursor-pointer transition-all rotate-0"+(i?" animate-wiggle":""),style:{animationDelay:`${Math.random()*250}ms`},tabIndex:0,...p(),onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&g()},children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(J,{name:t.name}),e.jsxs("div",{className:"flex flex-col items-start justify-center",children:[e.jsx("h2",{className:"font-bold capitalize",children:t.name}),e.jsx("div",{children:u===0?"*** ***":d.length===0?"Decrypting...":w==="Token Error"?"Token Error":e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:w.slice(0,3)}),e.jsx("span",{children:w.slice(3,6)})]})})]})]}),e.jsx("button",{className:"absolute -top-3 -right-3 !p-1 text-slate-800 bg-white border border-slate-400 rounded-full hover:text-white hover:brightness-100 sm:hover:bg-danger transition-all duration-300",style:{pointerEvents:i?"auto":"none",opacity:i?1:0},tabIndex:i?0:-1,onClick:h=>{h.stopPropagation(),window.confirm(`Are you sure you want to remove ${t.name}? This cannot be undone!`)&&window.confirm("Are you really sure?")&&A(s,{keys:Z(t)})},onMouseDown:h=>h.stopPropagation(),onTouchStart:h=>h.stopPropagation(),onPointerDown:h=>h.stopPropagation(),children:e.jsx(z,{})})]})}function ft({userData:t,userRef:s,editMode:r,setEditMode:n,editKey:o,setEditKey:i}){const{time:l,timestamp:d}=qe(),f=m.useContext(L)||"",[u,y]=m.useState(""),[c,a]=m.useState(),g=Ve(),p=3e4-l.getTime()%3e4,b=Math.ceil(p/1e3),w=30-b;m.useEffect(()=>{r&&navigator.vibrate&&navigator.vibrate(200)},[r]);const k=m.useMemo(()=>e.jsxs(e.Fragment,{children:[t.keys.length===0&&e.jsx("div",{className:"text-center text-lg bg-slate-800 p-8 w-full rounded-md",children:"No keys added yet"}),t.keys.length>0&&e.jsxs("div",{className:"w-full max-w-screen-lg",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"mb-6 pl-10",type:"search",value:u,placeholder:"Search tokens",onChange:h=>y(h.target.value)}),e.jsx("svg",{className:"fill-slate-400 absolute left-3 top-[11px] h-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",children:e.jsx("path",{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"})})]}),e.jsx("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6",children:t.keys.filter(h=>u.length===0||h.name.toLowerCase().includes(u.toLowerCase())).sort((h,j)=>h.name.localeCompare(j.name)).map(h=>{try{return e.jsx(ut,{data:h,userRef:s,timestamp:d,onEdit:()=>{const j=x.info("Decrypting token...",{autoClose:1500});C(f,h.secret).then(S=>{x.dismiss(j),i(!0),a({name:h.name,secret:S.secret})}).catch(S=>{x.dismiss(j),console.error(S),x.error("Failed to decrypt token",{autoClose:2500})})},setEditMode:n,editMode:r},h.name)}catch(j){return console.error(j),e.jsxs("div",{children:["Error Loading Token (",h.name,")"]})}})})]})]}),[t.keys,u,d,s,r]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex sm:justify-center pl-8 sm:pl-0 fixed bottom-0 left-0 right-0 z-10 backdrop-blur-lg bg-slate-900 bg-opacity-30 pt-4 border-t-2 border-secondary",children:[e.jsx("div",{className:"w-16 h-16 p-1 mb-6",children:e.jsx(de,{value:b-1,maxValue:30,text:b.toString(),styles:ue({textSize:"40px",trailColor:g.theme.colors.slate[700],textColor:g.theme.colors.primary,pathColor:g.theme.colors.primary}),strokeWidth:10})}),e.jsx("div",{className:"fixed bottom-1 h-1.5 bg-primary transition-all duration-700 z-20 rounded",style:{left:`${w/30*50}%`,right:`${w/30*50}%`}})]}),e.jsx("div",{className:"flex flex-col gap-4 m-6 sm:m-8 items-center pb-24",children:k}),o&&e.jsx(ct,{title:c!=null&&c.name||c!=null&&c.secret?"Edit existing key":"Add a new key",onClose:()=>{i(!1),a(void 0)},children:e.jsx(it,{name:c==null?void 0:c.name,secret:c==null?void 0:c.secret,userRef:s,close:()=>{i(!1),a(void 0)}})})]})}function mt(){const[t,s,r]=D(v);return s||r?e.jsx(N,{children:r&&e.jsxs("p",{children:["Error: ",r.message]})}):t?e.jsx(gt,{user:t}):e.jsx(N,{children:e.jsx(Ge,{})})}async function K(t){let s="",r=0;for(;s.length!==6&&r<3;)s=prompt("Set a new 6 digit pin")||"",r++;if(s.length===6&&(prompt("Re-enter 6 digit pin")||"")!==s){x.error("Pins do not match");return}if(s.length===6){t||(t=crypto.getRandomValues(new Uint32Array(32)).toString());try{return await E(s,{token:t})}catch(n){console.error(n)}}}function X({className:t}){return Te()?null:e.jsx(fe,{className:"text-danger fixed top-2 right-2 text-2xl z-10 "+t,title:"You are currently offline. It is not recommend to add/edit keys offline to avoid conflicts."})}function gt({user:t}){var a;const{value:s,loading:r,error:n,userRef:o}=Re(),[i,l]=m.useState(),[d,f]=m.useState(!1),[u,y]=m.useState(!1);m.useEffect(()=>{const g=()=>{document.visibilityState==="visible"&&l(void 0)};return document.addEventListener("visibilitychange",g),()=>document.removeEventListener("visibilitychange",g)},[]),m.useEffect(()=>{!r&&!n&&(s==null?void 0:s.data())===void 0&&K().then(g=>{g?Ae(o,{keys:[],email:t.email||"",code:g,webauthn:[]}):x.error("Failed to create user")})},[s,r,n]);const c=async()=>{if(!confirm("Would you like to update your pin?"))return;const g=await K(i);g?A(o,{code:g}):x.error("Failed to update pin")};return r||n||!s||s.data()===void 0?e.jsxs(N,{children:[n&&e.jsxs("p",{children:["Error: ",n.message]}),!s||s.data()===void 0&&e.jsx("p",{children:"No data"})]}):i?e.jsxs(L.Provider,{value:i,children:[e.jsx(X,{}),e.jsx(Ze,{lock:()=>l(void 0),updateCode:c,editMode:d,setEditKey:y,setEditMode:f,exportKeys:()=>De(i,s.data()),importKeys:()=>ze(i,s.data(),o)}),e.jsx(ft,{userData:s.data(),userRef:o,editMode:d,setEditMode:f,editKey:u,setEditKey:y})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"!bottom-4 !right-5 top-auto"}),e.jsx(Xe,{unlock:g=>l(g),encryptedCode:(a=s.data())==null?void 0:a.code,data:s.data(),userRef:o})]})}window.global||(window.global=window);globalThis.Buffer=me.Buffer;const pt=matchMedia("(display-mode: browser)").matches;pt||window.resizeTo(500,760);const G=navigator;G.virtualKeyboard&&(G.virtualKeyboard.overlaysContent=!0);const ht=Pe({onNeedRefresh(){x.warn("New version available, tap to update.",{autoClose:!1,onClick:()=>{ht(),x.warn("Updating...",{autoClose:!1})},closeOnClick:!0})}});function xt(){return e.jsxs(m.StrictMode,{children:[e.jsx(mt,{}),e.jsx(pe,{theme:"dark",position:"bottom-center",transition:he,hideProgressBar:!0,closeButton:!1})]})}ge(document.getElementById("root")).render(e.jsx(xt,{}));export{kt as a,Ct as c,At as g};
//# sourceMappingURL=index-D0hPhKkn.js.map
